// This file was generated by liblab | https://liblab.com/

using System.Text.Json;
using System.Text.Json.Serialization;
using PostmanClient.OneOf;

namespace PostmanClient.Json;

internal class OneOfJsonConverterFactory : JsonConverterFactory
{
    public override bool CanConvert(Type typeToConvert)
    {
        if (!typeToConvert.IsGenericType)
            return false;

        var typeDefinition = typeToConvert.GetGenericTypeDefinition();
        return typeDefinition.IsAssignableTo(typeof(IOneOf));
    }

    public override JsonConverter? CreateConverter(
        Type typeToConvert,
        JsonSerializerOptions options
    )
    {
        var jsonConverterType = typeof(OneOfJsonConverter<>).MakeGenericType(typeToConvert);
        var instance =
            Activator.CreateInstance(jsonConverterType)
            ?? throw new InvalidOperationException("Failed to create OneOfJsonConverter instance");
        return (JsonConverter)instance;
    }
}
